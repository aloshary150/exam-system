<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>لوحة تحكم المعلم</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <h2>لوحة تحكم المعلم</h2>

    <input id="password" placeholder="كلمة سر المعلم" type="password" />

    <h3>إدارة الامتحانات</h3>
    <ul id="examList"></ul>

    <hr />

    <h3>إضافة سؤال لامتحان</h3>
    <input id="examId" placeholder="رقم الامتحان" readonly />
    <input id="q" placeholder="السؤال" />
    <input id="a1" placeholder="إجابة 1" />
    <input id="a2" placeholder="إجابة 2" />
    <input id="a3" placeholder="إجابة 3" />
    <input id="a4" placeholder="إجابة 4" />
    <input
      id="correct"
      type="number"
      placeholder="رقم الإجابة الصحيحة (0-3)"
      min="0"
      max="3"
    />
    <button onclick="addQuestion()">إضافة سؤال</button>

    <hr />

    <h3>عرض نتائج الطلاب</h3>
    <button onclick="loadResults()">عرض النتائج</button>
    <ul id="results"></ul>
  </div>

  <script>
    const passwordInput = document.getElementById("password");
    const examList = document.getElementById("examList");
    const examIdInput = document.getElementById("examId");
    const resultsList = document.getElementById("results");

    passwordInput.addEventListener("input", loadExams);

    async function loadExams() {
      const password = passwordInput.value.trim();
      if (!password) {
        examList.innerHTML = "";
        return;
      }

      try {
        const res = await fetch("/api/exam/list");
        const exams = await res.json();

        examList.innerHTML = "";
        exams.forEach((exam) => {
          const li = document.createElement("li");
          li.textContent = `${exam.subject} - الصف ${exam.grade} - مدة: ${exam.duration} دقيقة`;
          const btnDelete = document.createElement("button");
          btnDelete.textContent = "حذف";
          btnDelete.style.marginLeft = "10px";
          btnDelete.onclick = async () => {
            if (
              confirm(`هل أنت متأكد من حذف الامتحان: ${exam.subject} - الصف ${exam.grade}؟`)
            ) {
              const res = await fetch(`/api/teacher/delete-exam/${exam.id}`, {
                method: "DELETE",
                headers: { password },
              });
              if (res.ok) {
                alert("تم الحذف");
                loadExams();
              } else {
                alert("فشل الحذف");
              }
            }
          };

          li.onclick = () => {
            examIdInput.value = exam.id;
            alert(
              `تم اختيار الامتحان: ${exam.subject} - الصف ${exam.grade}\nرقم الامتحان تم تعبئته`
            );
          };

          li.appendChild(btnDelete);
          examList.appendChild(li);
        });
      } catch {
        examList.innerHTML = "خطأ في تحميل الامتحانات";
      }
    }

    async function addQuestion() {
      const password = passwordInput.value.trim();
      const examId = examIdInput.value.trim();
      const question = document.getElementById("q").value.trim();
      const answers = [
        document.getElementById("a1").value.trim(),
        document.getElementById("a2").value.trim(),
        document.getElementById("a3").value.trim(),
        document.getElementById("a4").value
