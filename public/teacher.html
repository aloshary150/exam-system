<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ููุญุฉ ุชุญูู ุงููุนูู</title>
<link rel="stylesheet" href="style.css">
</head>

<body>

<header>ููุญุฉ ุชุญูู ุงููุนูู</header>

<div class="container">

  <h3>ุงูุงูุชุญุงูุงุช</h3>
  <div id="exams"></div>

</div>

<script>
const examsDiv = document.getElementById("exams");

/* ุชุญููู ุงูุงูุชุญุงูุงุช */
fetch("/api/exams")
  .then(r => r.json())
  .then(exams => {
    if (exams.length === 0) {
      examsDiv.innerHTML = "<p>ูุง ุชูุฌุฏ ุงูุชุญุงูุงุช</p>";
      return;
    }

    exams.forEach(e => {
      const box = document.createElement("div");
      box.className = "exam-box";

      box.innerHTML = `
        <h4>${e.subject} - ${e.grade}</h4>
        <p>ุนุฏุฏ ุงูุฃุณุฆูุฉ: ${e.total_questions}</p>
        <p>ุงููุฏุฉ: ${e.duration} ุฏูููุฉ</p>

        <button onclick="showResults(${e.id})">๐ ุงููุชุงุฆุฌ</button>
        <button onclick="editExam(${e.id}, '${e.subject}', '${e.grade}', ${e.duration})">โ๏ธ ุชุนุฏูู</button>
        <button class="danger" onclick="deleteExam(${e.id})">๐ ุญุฐู</button>

        <div id="results-${e.id}" class="results"></div>
      `;

      examsDiv.appendChild(box);
    });
  });

/* ุนุฑุถ ุงููุชุงุฆุฌ */
function showResults(id){
  const div = document.getElementById("results-"+id);
  div.innerHTML = "ุฌุงุฑู ุงูุชุญููู...";

  fetch("/api/teacher/results/" + id)
    .then(r=>r.json())
    .then(data=>{
      if(data.length === 0){
        div.innerHTML = "<p>ูุง ุชูุฌุฏ ูุชุงุฆุฌ ุจุนุฏ</p>";
        return;
      }

      let html = "<table><tr><th>ุงูุทุงูุจ</th><th>ุงูุฏุฑุฌุฉ</th></tr>";
      data.forEach(s=>{
        html += `<tr><td>${s.student_name}</td><td>${s.score}</td></tr>`;
      });
      html += "</table>";

      div.innerHTML = html;
    });
}

/* ุญุฐู ุงูุชุญุงู */
function deleteExam(id){
  if(!confirm("ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ุงูุงูุชุญุงูุ")) return;

  fetch("/api/teacher/delete-exam/" + id, { method:"DELETE" })
    .then(()=>location.reload());
}

/* ุชุนุฏูู ุงูุชุญุงู */
function editExam(id, subject, grade, duration){
  const newSubject = prompt("ุงุณู ุงููุงุฏุฉ:", subject);
  const newGrade = prompt("ุงูุตู:", grade);
  const newDuration = prompt("ุงููุฏุฉ:", duration);

  if(!newSubject || !newGrade || !newDuration) return;

  fetch("/api/teacher/update-exam/" + id, {
    method:"PUT",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({
      subject:newSubject,
      grade:newGrade,
      duration:newDuration
    })
  }).then(()=>location.reload());
}
</script>

</body>
</html>
